<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaxBet - –°–æ–±—ã—Ç–∏—è –∏ —Å—Ç–∞–≤–∫–∏</title>
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
        <div class="logo">üéØ MaxBet</div>
        <div class="user-info">
            <div class="balance">
                –ë–∞–ª–∞–Ω—Å: <span id="user-balance">0 –ª—É–ø–∞–Ω—á–∏–∫–æ–≤</span>
                <button id="daily-bonus-btn" class="btn" style="margin-left:10px;" onclick="openDailyBonusModal()">–ü–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –Ω–∞–≥—Ä–∞–¥—É</button>
            </div>
            <div class="user-menu">
                <span>–ü—Ä–∏–≤–µ—Ç, <span id="username">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>!</span>
                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∑–¥–µ—Å—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                <button class="btn btn-secondary" onclick="logout()" style="padding: 8px 16px; width: auto;">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </div>
    
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="navigation">
        <a href="main.html" class="nav-tab active">üìÖ –°–æ–±—ã—Ç–∏—è</a>
        <a href="history.html" class="nav-tab">üìä –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫</a>
        <a href="profile.html" class="nav-tab">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
        <a href="admin.html" class="nav-tab" id="admin-link" style="display: none;">üõ†Ô∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</a>
        <a href="moderator.html" class="nav-tab" id="moderator-link" style="display: none;">üõ°Ô∏è –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</a>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content">
        <!-- –°–µ–∫—Ü–∏—è —Å–æ–±—ã—Ç–∏–π -->
        <div class="events-section">
            <h2 class="section-title">–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è</h2>
            
            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="events-filters">
                <button class="filter-btn active" onclick="filterEvents('all')">–í—Å–µ</button>
                <button class="filter-btn" onclick="filterEvents('politics')">üèõÔ∏è –ü–æ–ª–∏—Ç–∏–∫–∞</button>
                <button class="filter-btn" onclick="filterEvents('entertainment')">üé≠ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</button>
                <button class="filter-btn" onclick="filterEvents('technology')">üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</button>
                <button class="filter-btn" onclick="filterEvents('economics')">üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞</button>
                <button class="filter-btn" onclick="filterEvents('weather')">üå§Ô∏è –ü–æ–≥–æ–¥–∞</button>
                <button class="filter-btn" onclick="filterEvents('society')">üë• –û–±—â–µ—Å—Ç–≤–æ</button>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π -->
            <div id="events-container" class="events-grid">
                <div class="loading">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...</div>
            </div>
        </div>
        
        <!-- –ö–æ—Ä–∑–∏–Ω–∞ —Å—Ç–∞–≤–æ–∫ -->
        <div class="bet-slip-section">
            <h3 class="section-title" style="font-size: 20px;">–ö–æ—Ä–∑–∏–Ω–∞ —Å—Ç–∞–≤–æ–∫</h3>
            <div id="bet-slip-content">
                <div class="bet-slip-empty">
                    <p>–ö–æ—Ä–∑–∏–Ω–∞ —Å—Ç–∞–≤–æ–∫ –ø—É—Å—Ç–∞</p>
                    <small>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Å—Ç–∞–≤–∫–∏</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞ -->
    <div id="dailyBonusModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDailyBonusModal()">&times;</span>
            <h3 class="modal-title">üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</h3>
            <p style="color: #b0bec5; text-align: center; margin-bottom: 20px;">
                –ü–æ–ª—É—á–∞–π—Ç–µ –±–æ–Ω—É—Å—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å! –ß–µ–º –¥–æ–ª—å—à–µ —Å–µ—Ä–∏—è, —Ç–µ–º –±–æ–ª—å—à–µ –Ω–∞–≥—Ä–∞–¥–∞.
            </p>
            <div id="bonus-calendar" class="calendar-grid">
                <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <small style="color: #b0bec5;">
                    üí° –ó–∞—Ö–æ–¥–∏—Ç–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å —Å–µ—Ä–∏—é!
                </small>
            </div>
        </div>
    </div>
    
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <script src="firebase-config.js"></script>
    
    <!-- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ sync-manager –∏ main.js -->
    <script type="module">
        console.log('üìù –ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è main.html');
        
        // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º sync-manager
        import('./sync-manager.js').then(() => {
            console.log('‚úÖ Sync Manager –∑–∞–≥—Ä—É–∂–µ–Ω –≤ main.html');
            
            // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ sync-manager
            setTimeout(() => {
                // –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–∞–µ–º main.js
                import('./main.js').then(() => {
                    console.log('‚úÖ Main.js –∑–∞–≥—Ä—É–∂–µ–Ω –≤ main.html');
                }).catch(error => {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ main.js:', error);
                    showErrorMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–æ–¥—É–ª—è: ' + error.message);
                });
            }, 500);
            
        }).catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ sync-manager.js:', error);
            
            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å main.js –±–µ–∑ sync manager (fallback —Ä–µ–∂–∏–º)
            console.log('‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ main.js –≤ fallback —Ä–µ–∂–∏–º–µ');
            import('./main.js').then(() => {
                console.log('‚ö†Ô∏è Main.js –∑–∞–≥—Ä—É–∂–µ–Ω –≤ fallback —Ä–µ–∂–∏–º–µ');
                showWarningMessage('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã.');
            }).catch(mainError => {
                console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ main.js:', mainError);
                showErrorMessage('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            });
        });
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        function showErrorMessage(message) {
            const container = document.querySelector('.main-content');
            if (container) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #f44336;">
                        <div style="font-size: 64px; margin-bottom: 20px;">‚ö†Ô∏è</div>
                        <h2 style="color: #f44336; margin-bottom: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                        <p style="color: #b0bec5; margin-bottom: 30px;">${message}</p>
                        <button class="btn" onclick="location.reload()">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
                        <br><br>
                        <a href="login.html" class="btn btn-secondary">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—Ö–æ–¥—É</a>
                    </div>
                `;
            }
        }
        
        function showWarningMessage(message) {
            const header = document.querySelector('.header');
            if (header) {
                const warning = document.createElement('div');
                warning.style.cssText = `
                    background: rgba(255, 152, 0, 0.9);
                    color: white;
                    text-align: center;
                    padding: 10px;
                    font-size: 14px;
                    font-weight: 500;
                `;
                warning.textContent = '‚ö†Ô∏è ' + message;
                header.parentNode.insertBefore(warning, header.nextSibling);
                
                // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    if (warning.parentNode) warning.remove();
                }, 10000);
            }
        }
    </script>
    
    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏
        window.testSync = function() {
            if (window.dataSyncManager) {
                console.log('üîÑ –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', window.dataSyncManager.getSyncStatus());
                console.log('üë§ –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', window.dataSyncManager.getCurrentUser());
                console.log('üì§ –û—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:', window.dataSyncManager.getPendingUpdatesCount());
            } else {
                console.log('‚ùå DataSyncManager –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        };
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        window.forceSync = function() {
            if (window.dataSyncManager) {
                window.dataSyncManager.forceRefresh()
                    .then(() => console.log('‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞'))
                    .catch(error => console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error));
            } else {
                console.log('‚ùå DataSyncManager –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        };
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π
        window.reloadEvents = function() {
            if (window.loadEvents) {
                window.loadEvents();
            } else {
                console.log('‚ùå –§—É–Ω–∫—Ü–∏—è loadEvents –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
            }
        };
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        window.clearData = function() {
            if (window.dataSyncManager) {
                window.dataSyncManager.clearLocalData();
                console.log('üóëÔ∏è –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
            }
            localStorage.clear();
            location.reload();
        };
        
        // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            console.log('üéØ Main.html –∑–∞–≥—Ä—É–∂–µ–Ω');
            console.log('üîß Firebase config –¥–æ—Å—Ç—É–ø–µ–Ω:', !!window.firebaseConfig);
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ development —Ä–µ–∂–∏–º–µ
            if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                setTimeout(() => {
                    console.log('üõ†Ô∏è –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:');
                    console.log('   testSync() - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏');
                    console.log('   forceSync() - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å');
                    console.log('   reloadEvents() - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–±—ã—Ç–∏—è');
                    console.log('   clearData() - –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ');
                    console.log('   createTestData() - —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ');
                }, 3000);
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', function(e) {
            console.error('üö® JavaScript –æ—à–∏–±–∫–∞ –≤ main.html:', e.error);
            console.error('üìç –§–∞–π–ª:', e.filename, '–°—Ç—Ä–æ–∫–∞:', e.lineno);
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Promise –æ—à–∏–±–æ–∫
        window.addEventListener('unhandledrejection', function(e) {
            console.error('üö® –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è Promise –æ—à–∏–±–∫–∞:', e.reason);
            e.preventDefault();
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        });
        
        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        function updateConnectionStatus() {
            const isOnline = navigator.onLine;
            
            if (window.dataSyncManager) {
                // –û–±–Ω–æ–≤–∏–º —Å—Ç–∞—Ç—É—Å –≤ sync manager –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                if (isOnline !== window.dataSyncManager.isUserOnline()) {
                    console.log(`üåê –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–∏–ª–æ—Å—å: ${isOnline ? 'online' : 'offline'}`);
                }
            }
        }
        
        // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(updateConnectionStatus, 30000);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ–∫—É—Å–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        window.addEventListener('focus', function() {
            if (window.dataSyncManager && window.dataSyncManager.isUserOnline()) {
                setTimeout(() => {
                    window.dataSyncManager.forceRefresh().catch(console.error);
                }, 1000);
            }
        });
    </script>
</body>
</html>
