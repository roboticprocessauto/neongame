<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaxBet - –°–æ–±—ã—Ç–∏—è –∏ —Å—Ç–∞–≤–∫–∏</title>
    <style>
        /* ===== –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
        }

        .hidden {
            display: none !important;
        }

        /* ===== –®–ê–ü–ö–ê ===== */
        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #4fc3f7;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .balance {
            background: rgba(79, 195, 247, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø ===== */
        .navigation {
            background: rgba(0, 0, 0, 0.2);
            padding: 0;
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            background: rgba(255, 255, 255, 0.05);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            text-decoration: none;
            color: #fff;
        }

        .nav-tab:hover {
            background: rgba(79, 195, 247, 0.1);
        }

        .nav-tab.active {
            background: rgba(79, 195, 247, 0.2);
            border-bottom-color: #4fc3f7;
            color: #4fc3f7;
        }

        /* ===== –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ ===== */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ===== –°–û–ë–´–¢–ò–Ø ===== */
        .events-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            color: #4fc3f7;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: bold;
        }

        .events-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: rgba(79, 195, 247, 0.3);
            color: #4fc3f7;
        }

        .events-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .event-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .event-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .event-title {
            font-size: 18px;
            font-weight: bold;
            color: #4fc3f7;
            margin-bottom: 5px;
        }

        .event-category {
            background: rgba(79, 195, 247, 0.3);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            white-space: nowrap;
        }

        .event-description {
            color: #b0bec5;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .event-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .option-btn {
            background: linear-gradient(45deg, #4fc3f7, #29b6f6);
            border: none;
            color: #fff;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 195, 247, 0.4);
        }

        .option-btn.selected {
            background: linear-gradient(45deg, #4caf50, #388e3c);
        }

        .option-text {
            font-size: 14px;
        }

        .option-coefficient {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        /* ===== –ö–û–†–ó–ò–ù–ê –°–¢–ê–í–û–ö ===== */
        .bet-slip-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        .bet-slip-empty {
            text-align: center;
            color: #b0bec5;
            padding: 40px 20px;
        }

        .bet-slip-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            position: relative;
        }

        .bet-slip-event {
            font-weight: bold;
            color: #4fc3f7;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .bet-slip-option {
            color: #b0bec5;
            font-size: 13px;
        }

        .btn-remove {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f44336;
            border: none;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            line-height: 1;
        }

        .bet-slip-total {
            background: rgba(79, 195, 247, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }

        .total-coefficient {
            font-size: 18px;
            font-weight: bold;
            color: #4fc3f7;
        }

        .bet-slip-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .bet-amount-input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 14px;
        }

        .bet-amount-input:focus {
            outline: none;
            border-color: #4fc3f7;
            box-shadow: 0 0 10px rgba(79, 195, 247, 0.3);
        }

        .bet-amount-input::placeholder {
            color: #b0bec5;
        }

        .potential-win {
            text-align: center;
            color: #4caf50;
            font-weight: bold;
            margin: 10px 0;
        }

        /* ===== –ö–ù–û–ü–ö–ò ===== */
        .btn {
            background: linear-gradient(45deg, #4fc3f7, #29b6f6);
            border: none;
            color: #fff;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
            width: 100%;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 195, 247, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #78909c, #607d8b);
        }

        .btn-success {
            background: linear-gradient(45deg, #4caf50, #388e3c);
        }

        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4fc3f7;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success { background: #4caf50; }
        .notification.error { background: #f44336; }
        .notification.warning { background: #ff9800; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ===== –ó–ê–ì–†–£–ó–ö–ê ===== */
        .loading {
            text-align: center;
            padding: 40px;
            color: #b0bec5;
        }

        .loading::after {
            content: "";
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #4fc3f7;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ===== */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 15px;
            }

            .bet-slip-section {
                position: static;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .user-info {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
                width: 100%;
            }

            .navigation {
                flex-wrap: wrap;
            }

            .nav-tab {
                flex: 1;
                text-align: center;
                padding: 12px 15px;
                min-width: 120px;
            }

            .events-filters {
                justify-content: center;
            }

            .event-options {
                grid-template-columns: 1fr;
            }

            .main-content {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
        <div class="logo">üéØ MaxBet</div>
        <div class="user-info">
            <div class="balance">
                –ë–∞–ª–∞–Ω—Å: <span id="user-balance">0 –º–æ–Ω–µ—Ç</span>
            </div>
            <div class="user-menu">
                <span>–ü—Ä–∏–≤–µ—Ç, <span id="username">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>!</span>
                <button class="btn btn-secondary" onclick="logout()" style="padding: 8px 16px; width: auto;">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="navigation">
        <a href="main.html" class="nav-tab active">üìÖ –°–æ–±—ã—Ç–∏—è</a>
        <a href="history.html" class="nav-tab">üìä –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫</a>
        <a href="profile.html" class="nav-tab">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
        <a href="index.html" class="nav-tab" id="admin-link" style="display: none;">üõ†Ô∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</a>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content">
        <!-- –°–µ–∫—Ü–∏—è —Å–æ–±—ã—Ç–∏–π -->
        <div class="events-section">
            <h2 class="section-title">–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è</h2>
            
            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="events-filters">
                <button class="filter-btn active" onclick="filterEvents('all')">–í—Å–µ</button>
                <button class="filter-btn" onclick="filterEvents('politics')">üèõÔ∏è –ü–æ–ª–∏—Ç–∏–∫–∞</button>
                <button class="filter-btn" onclick="filterEvents('entertainment')">üé≠ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</button>
                <button class="filter-btn" onclick="filterEvents('technology')">üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</button>
                <button class="filter-btn" onclick="filterEvents('economics')">üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞</button>
                <button class="filter-btn" onclick="filterEvents('weather')">üå§Ô∏è –ü–æ–≥–æ–¥–∞</button>
                <button class="filter-btn" onclick="filterEvents('society')">üë• –û–±—â–µ—Å—Ç–≤–æ</button>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π -->
            <div id="events-container" class="events-grid">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...</div>
            </div>
        </div>

        <!-- –ö–æ—Ä–∑–∏–Ω–∞ —Å—Ç–∞–≤–æ–∫ -->
        <div class="bet-slip-section">
            <h3 class="section-title" style="font-size: 20px;">–ö–æ—Ä–∑–∏–Ω–∞ —Å—Ç–∞–≤–æ–∫</h3>
            <div id="bet-slip-content">
                <div class="bet-slip-empty">
                    <p>–ö–æ—Ä–∑–∏–Ω–∞ —Å—Ç–∞–≤–æ–∫ –ø—É—Å—Ç–∞</p>
                    <small>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Å—Ç–∞–≤–∫–∏</small>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <script src="firebase-config.js"></script>
    <script type="module">
        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø FIREBASE =====
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getDatabase, 
            ref as dbRef, 
            set as dbSet, 
            get as dbGet, 
            update as dbUpdate, 
            push as dbPush,
            onValue,
            off
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        const app = initializeApp(window.firebaseConfig);
        const database = getDatabase(app);

        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π Firebase –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        window.database = database;
        window.dbRef = dbRef;
        window.dbSet = dbSet;
        window.dbGet = dbGet;
        window.dbUpdate = dbUpdate;
        window.dbPush = dbPush;
        window.onValue = onValue;
        window.off = off;

        // ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
        let currentUser = null;
        let events = {};
        let betSlip = [];
        let settings = {
            maxBetAmount: 1000,
            defaultBalance: 5000,
            minBetAmount: 1,
            maxCoefficient: 50
        };

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
        window.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadSettings();
            loadEvents();
        });

        function checkAuth() {
            const savedUser = localStorage.getItem('currentUser');
            if (!savedUser) {
                window.location.href = 'login.html';
                return;
            }
            
            currentUser = JSON.parse(savedUser);
            updateUserInfo();
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∞–¥–º–∏–Ω —Å—Å—ã–ª–∫—É –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω/–º–æ–¥–µ—Ä–∞—Ç–æ—Ä
            if (currentUser.role === 'admin' || currentUser.role === 'moderator') {
                document.getElementById('admin-link').style.display = 'block';
            }
        }

        function updateUserInfo() {
            if (!currentUser) return;
            
            document.getElementById('user-balance').textContent = `${currentUser.balance.toLocaleString()} –º–æ–Ω–µ—Ç`;
            document.getElementById('username').textContent = currentUser.username;
        }

        // ===== –ó–ê–ì–†–£–ó–ö–ê –ù–ê–°–¢–†–û–ï–ö =====
        async function loadSettings() {
            try {
                const settingsRef = dbRef(database, 'settings');
                const snapshot = await dbGet(settingsRef);
                
                if (snapshot.exists()) {
                    Object.assign(settings, snapshot.val());
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
            }
        }

        // ===== –ó–ê–ì–†–£–ó–ö–ê –°–û–ë–´–¢–ò–ô =====
        async function loadEvents() {
            try {
                const eventsRef = dbRef(database, 'events');
                const snapshot = await dbGet(eventsRef);
                
                if (snapshot.exists()) {
                    events = snapshot.val();
                } else {
                    // –°–æ–∑–¥–∞—Ç—å –¥–µ–º–æ —Å–æ–±—ã—Ç–∏—è –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
                    await createDemoEvents();
                }
                
                displayEvents();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π:', error);
            }
        }

        async function createDemoEvents() {
            const demoEvents = {
                'demo1': {
                    title: '–í—ã–±–æ—Ä—ã –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞ –°–®–ê 2028',
                    description: '–ö—Ç–æ —Å—Ç–∞–Ω–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–æ–º –°–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –®—Ç–∞—Ç–æ–≤ –ê–º–µ—Ä–∏–∫–∏?',
                    category: 'politics',
                    options: ['–î–µ–º–æ–∫—Ä–∞—Ç—ã', '–†–µ—Å–ø—É–±–ª–∏–∫–∞–Ω—Ü—ã', '–¢—Ä–µ—Ç—å—è –ø–∞—Ä—Ç–∏—è'],
                    coefficients: [1.8, 2.1, 8.5],
                    status: 'active',
                    createdAt: Date.now()
                },
                'demo2': {
                    title: 'Bitcoin –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç $100,000',
                    description: '–î–æ—Å—Ç–∏–≥–Ω–µ—Ç –ª–∏ –∫—É—Ä—Å Bitcoin –æ—Ç–º–µ—Ç–∫–∏ –≤ $100,000 –¥–æ –∫–æ–Ω—Ü–∞ 2025 –≥–æ–¥–∞?',
                    category: 'economics',
                    options: ['–î–∞', '–ù–µ—Ç'],
                    coefficients: [2.5, 1.4],
                    status: 'active',
                    createdAt: Date.now()
                },
                'demo3': {
                    title: '–ù–æ–≤—ã–π iPhone –≤ 2025',
                    description: '–ö–∞–∫–∞—è –±—É–¥–µ—Ç –≥–ª–∞–≤–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –Ω–æ–≤–æ–≥–æ iPhone –≤ 2025 –≥–æ–¥—É?',
                    category: 'technology',
                    options: ['–°–∫–ª–∞–¥–Ω–æ–π —ç–∫—Ä–∞–Ω', 'Holographic –¥–∏—Å–ø–ª–µ–π', '–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π AI —á–∏–ø'],
                    coefficients: [3.2, 7.5, 2.8],
                    status: 'active',
                    createdAt: Date.now()
                }
            };

            try {
                const eventsRef = dbRef(database, 'events');
                await dbSet(eventsRef, demoEvents);
                events = demoEvents;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–º–æ —Å–æ–±—ã—Ç–∏–π:', error);
            }
        }

        function displayEvents(filter = 'all') {
            const container = document.getElementById('events-container');
            container.innerHTML = '';

            const filteredEvents = Object.entries(events).filter(([id, event]) => {
                return event.status === 'active' && (filter === 'all' || event.category === filter);
            });

            if (filteredEvents.length === 0) {
                container.innerHTML = '<div class="bet-slip-empty"><p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                return;
            }

            filteredEvents.forEach(([eventId, event]) => {
                const eventElement = document.createElement('div');
                eventElement.className = 'event-card';
                eventElement.innerHTML = `
                    <div class="event-header">
                        <div>
                            <div class="event-title">${event.title}</div>
                        </div>
                        <div class="event-category">${getCategoryName(event.category)}</div>
                    </div>
                    <div class="event-description">${event.description}</div>
                    <div class="event-options">
                        ${event.options.map((option, index) => `
                            <button class="option-btn" onclick="selectOption('${eventId}', '${option}', ${event.coefficients[index]})">
                                <span class="option-text">${option}</span>
                                <span class="option-coefficient">${event.coefficients[index]}</span>
                            </button>
                        `).join('')}
                    </div>
                `;
                container.appendChild(eventElement);
            });
        }

        function getCategoryName(category) {
            const categories = {
                'politics': 'üèõÔ∏è –ü–æ–ª–∏—Ç–∏–∫–∞',
                'entertainment': 'üé≠ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', 
                'technology': 'üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏',
                'economics': 'üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞',
                'weather': 'üå§Ô∏è –ü–æ–≥–æ–¥–∞',
                'society': 'üë• –û–±—â–µ—Å—Ç–≤–æ'
            };
            return categories[category] || category;
        }

        // ===== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –°–û–ë–´–¢–ò–ô =====
        window.filterEvents = function(category) {
            // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            displayEvents(category);
        };

        // ===== –ö–û–†–ó–ò–ù–ê –°–¢–ê–í–û–ö =====
        window.selectOption = function(eventId, option, coefficient) {
            if (!currentUser) {
                showNotification('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–æ–∫', 'error');
                return;
            }

            const event = events[eventId];
            if (!event) return;

            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–∏ —É–∂–µ —Å—Ç–∞–≤–∫–∞ –Ω–∞ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ
            const existingIndex = betSlip.findIndex(item => item.eventId === eventId);
            
            if (existingIndex !== -1) {
                // –ó–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç–∞–≤–∫—É
                betSlip[existingIndex] = {
                    eventId: eventId,
                    eventTitle: event.title,
                    option: option,
                    coefficient: coefficient
                };
            } else {
                // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞–≤–∫—É
                betSlip.push({
                    eventId: eventId,
                    eventTitle: event.title,
                    option: option,
                    coefficient: coefficient
                });
            }

            updateBetSlipDisplay();
            showNotification('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É —Å—Ç–∞–≤–æ–∫', 'success');
        };

        function updateBetSlipDisplay() {
            const container = document.getElementById('bet-slip-content');
            
            if (betSlip.length === 0) {
                container.innerHTML = `
                    <div class="bet-slip-empty">
                        <p>–ö–æ—Ä–∑–∏–Ω–∞ —Å—Ç–∞–≤–æ–∫ –ø—É—Å—Ç–∞</p>
                        <small>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Å—Ç–∞–≤–∫–∏</small>
                    </div>
                `;
                return;
            }

            const totalCoefficient = betSlip.reduce((total, bet) => total * bet.coefficient, 1);

            container.innerHTML = `
                <div class="bet-slip-items">
                    ${betSlip.map((bet, index) => `
                        <div class="bet-slip-item">
                            <button class="btn-remove" onclick="removeFromBetSlip(${index})">√ó</button>
                            <div class="bet-slip-event">${bet.eventTitle}</div>
                            <div class="bet-slip-option">${bet.option} (${bet.coefficient})</div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="bet-slip-total">
                    <div>–û–±—â–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç:</div>
                    <div class="total-coefficient">${totalCoefficient.toFixed(2)}</div>
                </div>
                
                <div class="bet-slip-controls">
                    <input type="number" 
                           class="bet-amount-input" 
                           id="bet-amount" 
                           placeholder="–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏" 
                           min="${settings.minBetAmount}" 
                           max="${Math.min(currentUser.balance, currentUser.betLimit || settings.maxBetAmount)}"
                           oninput="updatePotentialWin()">
                    
                    <div id="potential-win" class="potential-win" style="display: none;"></div>
                    
                    ${betSlip.length === 1 ? 
                        `<button class="btn" onclick="placeBet('single')">–°–¥–µ–ª–∞—Ç—å –æ–¥–∏–Ω–æ—á–Ω—É—é —Å—Ç–∞–≤–∫—É</button>` : 
                        `<button class="btn" onclick="placeBet('express')">–°–¥–µ–ª–∞—Ç—å —ç–∫—Å–ø—Ä–µ—Å—Å —Å—Ç–∞–≤–∫—É</button>`
                    }
                    
                    <button class="btn btn-secondary" onclick="clearBetSlip()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
                </div>
            `;
        }

        window.removeFromBetSlip = function(index) {
            betSlip.splice(index, 1);
            updateBetSlipDisplay();
            showNotification('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã', 'warning');
        };

        window.clearBetSlip = function() {
            betSlip = [];
            updateBetSlipDisplay();
            showNotification('–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞', 'warning');
        };

        window.updatePotentialWin = function() {
            const amount = parseFloat(document.getElementById('bet-amount').value) || 0;
            const totalCoefficient = betSlip.reduce((total, bet) => total * bet.coefficient, 1);
            const potentialWin = amount * totalCoefficient;
            
            const potentialWinDiv = document.getElementById('potential-win');
            if (amount > 0) {
                potentialWinDiv.style.display = 'block';
                potentialWinDiv.textContent = `–í–æ–∑–º–æ–∂–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à: ${potentialWin.toFixed(2)} –º–æ–Ω–µ—Ç`;
            } else {
                potentialWinDiv.style.display = 'none';
            }
        };

        // ===== –†–ê–ó–ú–ï–©–ï–ù–ò–ï –°–¢–ê–í–û–ö =====
        window.placeBet = async function(type) {
            if (!currentUser) {
                showNotification('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }

            if (betSlip.length === 0) {
                showNotification('–ö–æ—Ä–∑–∏–Ω–∞ —Å—Ç–∞–≤–æ–∫ –ø—É—Å—Ç–∞', 'error');
                return;
            }

            const amount = parseInt(document.getElementById('bet-amount').value);

            if (!amount || amount < settings.minBetAmount) {
                showNotification(`–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: ${settings.minBetAmount} –º–æ–Ω–µ—Ç`, 'error');
                return;
            }

            if (amount > currentUser.balance) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', 'error');
                return;
            }

            if (amount > (currentUser.betLimit || settings.maxBetAmount)) {
                showNotification(`–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Å—Ç–∞–≤–∫–∏: ${currentUser.betLimit || settings.maxBetAmount} –º–æ–Ω–µ—Ç`, 'error');
                return;
            }

            try {
                let coefficient;
                let eventList;

                if (type === 'single' && betSlip.length === 1) {
                    coefficient = betSlip[0].coefficient;
                    eventList = betSlip;
                } else if (type === 'express' && betSlip.length > 1) {
                    coefficient = betSlip.reduce((total, bet) => total * bet.coefficient, 1);
                    eventList = betSlip;
                } else {
                    showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø —Å—Ç–∞–≤–∫–∏', 'error');
                    return;
                }

                // –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞–≤–∫—É –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
                const betsRef = dbRef(database, 'bets');
                const newBetRef = dbPush(betsRef);

                const bet = {
                    user: currentUser.username,
                    type: type,
                    amount: amount,
                    coefficient: parseFloat(coefficient.toFixed(2)),
                    status: 'pending',
                    timestamp: Date.now(),
                    events: eventList
                };

                await dbSet(newBetRef, bet);

                // –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userRef = dbRef(database, `users/${currentUser.username}`);
                const newBalance = currentUser.balance - amount;
                await dbUpdate(userRef, { balance: newBalance });

                currentUser.balance = newBalance;
                updateUserInfo();

                // –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É —Å—Ç–∞–≤–æ–∫
                betSlip = [];
                updateBetSlipDisplay();

                showNotification('–°—Ç–∞–≤–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!', 'success');

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏', 'error');
            }
        };

        // ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø =====
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ===== –í–´–•–û–î –ò–ó –°–ò–°–¢–ï–ú–´ =====
        window.logout = function() {
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        };

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.MaxBetApp = {
            currentUser,
            betSlip,
            events,
            settings
        };
    </script>
</body>
</html>
